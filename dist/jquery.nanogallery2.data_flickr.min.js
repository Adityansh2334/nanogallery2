/**!
 * @preserve nanogallery2 - FLICKR data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","nanogallery2"],t):"object"==typeof exports&&"function"==typeof require?t(require(["jquery","nanogallery2"])):t(jQuery)}((function(t){jQuery.nanogallery2.data_flickr=function(t,e){var i=t,r={url:function(){return"https://api.flickr.com/services/rest/"},thumbSize:"               sq",thumbAvailableSizes:new Array(75,100,150,240,500,640),thumbAvailableSizesStr:new Array("sq","t","q","s","m","z"),photoSize:"0",photoAvailableSizes:new Array(75,100,150,240,500,640,1024,1024,1600,2048,1e4),photoAvailableSizesStr:new Array("sq","t","q","s","m","z","b","l","h","k","o"),ApiKey:"2f0e634b471fdb47446abcb9c5afebdc"},l=function(t,e,l,s){var n=NGY2Item.GetIdx(i,t),u="",p="image";"NONE"==i.O.photoset.toUpperCase()||"NONE"==i.O.album.toUpperCase()?u=r.url()+"?&method=flickr.people.getPublicPhotos&api_key="+r.ApiKey+"&user_id="+i.O.userID+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_z,url_b,url_h,url_k&per_page=500&format=json":0==i.I[n].GetID()?(u=r.url()+"?&method=flickr.photosets.getList&api_key="+r.ApiKey+"&user_id="+i.O.userID+"&per_page=500&primary_photo_extras=tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",p="album"):u=r.url()+"?&method=flickr.photosets.getPhotos&api_key="+r.ApiKey+"&photoset_id="+i.I[n].GetID()+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",i.O.debugMode&&console.log("Flickr URL: "+u),h(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var m=setTimeout((function(){h(!1),c(i,"Could not retrieve AJAX data...")}),6e4),_=[],g=function(r,u){jQuery.getJSON(r+"&page="+u+"&jsoncallback=?",(function(f,b,v){var x=0;if("album"==p){if(void 0!==f.stat&&"fail"===f.stat)return c(i,"Could not retrieve Flickr album list: "+f.message+" (code: "+f.code+")."),!1;_=_.concat(f.photosets.photoset),x=f.photosets.pages}else if("NONE"==i.O.photoset.toUpperCase()||"NONE"==i.O.album.toUpperCase())_=_.concat(f.photos.photo),x=f.photos.pages;else{if(void 0!==f.stat&&"fail"===f.stat)return c(i,"Could not retrieve Flickr album: "+f.message+" (code: "+f.code+")."),!1;""==i.I[n].title&&(i.I[n].title=f.photoset.title),_=_.concat(f.photoset.photo),x=f.photoset.pages}x>u?g(r,u+1):(clearTimeout(m),h(!1),"album"==p?a(n,t,_):o(n,t,_),d(t),null!=e&&e(l,s,null))})).fail((function(t,e,r){clearTimeout(m),h(!1),c(i,"Could not retrieve Flickr ajax data: "+e+", "+r)}))};g(u,1)};function o(t,e,l){i.O.debugMode&&(console.log("Flickr parse photos:"),console.dir(l)),jQuery.each(l,(function(t,l){var o=l.id,a=l.url_sq,n=l.title;""!=i.O.thumbnailLabel.get("title")&&(n=p(a));var u=l.description._content,h=75,c=75,m=r.photoAvailableSizesStr.length-1;i.O.flickrSkipOriginal&&m--;for(t=m;t>=0;t--)if(null!=l["url_"+r.photoAvailableSizesStr[t]]){a=l["url_"+r.photoAvailableSizesStr[t]],h=parseInt(l["width_"+r.photoAvailableSizesStr[t]]),c=parseInt(l["height_"+r.photoAvailableSizesStr[t]]);break}var d={};for(var _ in l)0!=_.indexOf("height_")&&0!=_.indexOf("width_")&&0!=_.indexOf("url_")||(d[_]=l[_]);var g=void 0!==l.tags?l.tags:"",f=NGY2Item.New(i,n,u,o,e,"image",g);f.setMediaURL(a,"img"),f.imageWidth=h,f.imageHeight=c;var b={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};b=s(b,l,"l1"),b=s(b,l,"lN"),f.thumbs=b;var v=i.O.fnProcessData;null!==v&&("function"==typeof v?v(f,"flickr",l):window[v](f,"flickr",l))})),i.I[t].contentIsLoaded=!0}function a(t,e,r){i.O.debugMode&&(console.log("Flickr parse list of albums:"),console.dir(r)),jQuery.each(r,(function(t,r){var l=r.title._content;if(0==r.visibility_can_see_set)return!0;if(m(l,r.id)){var o=r.id,a=null!=r.description._content?r.description._content:"",n={};for(var u in r.primary_photo_extras)n[u]=r.primary_photo_extras[u];var h="";void 0!==r.primary_photo_extras&&void 0!==r.primary_photo_extras.tags&&(h=r.primary_photo_extras.tags);var c=NGY2Item.New(i,l,a,o,e,"album",h);c.numberItems=r.photos,c.thumbSizes=n;var p={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};p=s(p,r.primary_photo_extras,"l1"),p=s(p,r.primary_photo_extras,"lN"),c.thumbs=p;var d=i.O.fnProcessData;null!==d&&("function"==typeof d?d(c,"flickr",r):window[d](c,"flickr",r))}})),i.I[t].contentIsLoaded=!0}function s(t,e,r){var l=1;!0===i.tn.opt[r].crop&&(l=i.O.thumbnailCropScaleFactor);for(var o=["xs","sm","me","la","xl"],a=0;a<o.length;a++)if("auto"==i.tn.settings.width[r][o[a]]||""==i.tn.settings.width[r][o[a]]){var s=n(u="height_",h=Math.ceil(i.tn.settings.height[r][o[a]]*i.tn.scale*l*i.tn.settings.mosaic[r+"Factor"].h[o[a]]),e);t.url[r][o[a]]=s.url,t.width[r][o[a]]=s.width,t.height[r][o[a]]=s.height}else if("auto"==i.tn.settings.height[r][o[a]]||""==i.tn.settings.height[r][o[a]]){s=n(u="width_",h=Math.ceil(i.tn.settings.width[r][o[a]]*i.tn.scale*l*i.tn.settings.mosaic[r+"Factor"].w[o[a]]),e);t.url[r][o[a]]=s.url,t.width[r][o[a]]=s.width,t.height[r][o[a]]=s.height}else{var u="height_",h=Math.ceil(i.tn.settings.height[r][o[a]]*i.tn.scale*l*i.tn.settings.mosaic[r+"Factor"].h[o[a]]);i.tn.settings.width[r][o[a]]>i.tn.settings.height[r][o[a]]&&(u="width_",h=Math.ceil(i.tn.settings.width[r][o[a]]*i.tn.scale*l*i.tn.settings.mosaic[r+"Factor"].w[o[a]]));s=n(u,h,e);t.url[r][o[a]]=s.url,t.width[r][o[a]]=s.width,t.height[r][o[a]]=s.height}return t}function n(t,e,i){for(var l={url:"",width:0,height:0},o=0,a=0;a<r.thumbAvailableSizes.length;a++){var s=i[t+r.photoAvailableSizesStr[a]];if(null!=s&&(o=a,s>=e))break}var n=r.photoAvailableSizesStr[o];return l.url=i["url_"+n],l.width=parseInt(i["width_"+n]),l.height=parseInt(i["height_"+n]),l}var u=function(t,e){e()};var h=NGY2Tools.PreloaderDisplay.bind(i),c=NGY2Tools.NanoAlert,p=NGY2Tools.GetImageTitleFromURL.bind(i),m=NGY2Tools.FilterAlbumName.bind(i),d=NGY2Tools.AlbumPostProcess.bind(i);switch(e){case"GetHiddenAlbums":var _=arguments[2];u(_,arguments[3]);break;case"AlbumGetContent":var g=arguments[2],f=arguments[4],b=arguments[5];l(g,arguments[3],f,b)}}}));