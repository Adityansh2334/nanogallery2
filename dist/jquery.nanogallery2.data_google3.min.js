/**!
 * @preserve nanogallery2 - GOOGLE PHOTOS data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","nanogallery2"],e):"object"==typeof exports&&"function"==typeof require?e(require(["jquery","nanogallery2"])):e(jQuery)}((function(e){jQuery.nanogallery2.data_google2=function(e,t){var a=e,o=function(e,t,o,n){var s="",d="image",g=NGY2Item.GetIdx(a,e),m="";a.galleryMaxItems.Get()>0&&(m="&max-results="+a.galleryMaxItems.Get());var h="";"undefined"!=typeof ngy2_pwa_at&&(h=ngy2_pwa_at),0==e?(s=""!=h?"https://photoslibrary.googleapis.com/v1/albums":a.O.google2URL+"?nguserid="+a.O.userID+"&alt=json&v=3&kind=album"+m+"&rnd="+(new Date).getTime(),d="album"):s=""!=h?"https://photoslibrary.googleapis.com/v1/mediaItems:search":a.O.google2URL+"?nguserid="+a.O.userID+"&ngalbumid="+e+"&alt=json&v=3&kind=photo&"+m,a.O.debugMode&&console.log("Google Photos URL: "+s),r(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;try{var c=setTimeout((function(){r(!1),l("Could not retrieve AJAX data...")}),6e4);jQuery.getJSON(s+"&callback=?",(function(s){if("error"==s.nano_status)return clearTimeout(c),r(!1),void l(a,"Could not retrieve Google data. Error: "+s.nano_message);clearTimeout(c),r(!1),i(g,d,s),u(e),null!=t&&t(o,n,null)})).fail((function(e,t,o){clearTimeout(c),r(!1);var i="";for(var n in e)i+=n+"="+e[n]+"<br>";l(a,"Could not retrieve Google data. Error: "+(t+", "+o+" "+i+"<br><br>URL:"+s))}))}catch(e){l(a,"Could not retrieve Google data. Error: "+e)}};function i(e,t,o){a.O.debugMode&&(console.log("Google Photos data:"),console.dir(o));var i=a.I[e].GetID();jQuery.each(o,(function(e,o){if("object"==typeof o&&null!==o){var r="";null==(r="image"==t?o.description:o.title)&&(r="");var l=o.id;if("album"==t&&(!d(r,l)||null==o.coverPhotoBaseUrl))return!0;var u=NGY2Item.New(a,r,"",l,i,t,""),g=0,m=0,h="";"image"==t?(h=o.baseUrl,a.O.viewerZoom||null==a.O.viewerZoom?h+="=h"+o.mediaMetadata.height+"-w"+o.mediaMetadata.width:window.screen.width>window.screen.height?h+="=w"+window.screen.width:h=s+"=h"+window.screen.height,u.setMediaURL(h,"img"),void 0!==o.mediaMetadata.width&&(u.imageWidth=parseInt(o.mediaMetadata.width),g=u.imageWidth),void 0!==o.mediaMetadata.height&&(u.imageHeight=parseInt(o.mediaMetadata.height),m=u.imageHeight),void 0!==o.mediaMetadata.photo&&(null!=o.mediaMetadata.photo.exposureTime&&(u.exif.exposure=o.mediaMetadata.photo.exposureTime),null!=o.mediaMetadata.photo.focalLength&&(u.exif.focallength=o.mediaMetadata.photo.focalLength),null!=o.mediaMetadata.photo.apertureFNumber&&(u.exif.fstop=o.mediaMetadata.photo.apertureFNumber),null!=o.mediaMetadata.photo.isoEquivalent&&(u.exif.iso=o.mediaMetadata.photo.isoEquivalent),null!=o.mediaMetadata.photo.cameraModel&&(u.exif.model=o.mediaMetadata.photo.cameraModel)),void 0!==o.mediaMetadata.video&&(null!=o.mediaMetadata.video.cameraModel&&(u.exif.model=o.mediaMetadata.video.cameraModel),u.downloadURL=o.baseUrl+"=dv")):u.numberItems=o.mediaItemsCount,u.thumbs=n("l1",u.thumbs,o,t,m,g),u.thumbs=n("lN",u.thumbs,o,t,m,g);var c=a.O.fnProcessData;null!==c&&("function"==typeof c?c(u,"google2",o):window[c](u,"google2",o))}})),a.I[e].contentIsLoaded=!0}function n(e,t,o,i,n,r){for(var l=["xs","sm","me","la","xl"],s=0;s<l.length;s++){if("image"==i){if("auto"==a.tn.settings.width[e][l[s]]){var d=r/n;t.height[e][l[s]]=a.tn.settings.getH(e,l[s]),t.width[e][l[s]]=a.tn.settings.getH(e,l[s])*d,t.url[e][l[s]]=o.baseUrl+"=h"+a.tn.settings.getH(e,l[s]);continue}if("auto"==a.tn.settings.height[e][l[s]]){d=n/r;t.width[e][l[s]]=a.tn.settings.getW(e,l[s]),t.height[e][l[s]]=a.tn.settings.getW(e,l[s])*d,t.url[e][l[s]]=o.baseUrl+"=w"+a.tn.settings.getW(e,l[s]);continue}t.height[e][l[s]]=a.tn.settings.getH(e,l[s]),t.width[e][l[s]]=a.tn.settings.getW(e,l[s]),t.url[e][l[s]]=o.baseUrl+"=w"+a.tn.settings.getW(e,l[s])}if("album"==i){if("auto"==a.tn.settings.width[e][l[s]]){t.url[e][l[s]]=o.coverPhotoBaseUrl+"=h"+a.tn.settings.getH(e,l[s]);continue}if("auto"==a.tn.settings.height[e][l[s]]){t.url[e][l[s]]=o.coverPhotoBaseUrl+"=w"+a.tn.settings.getW(e,l[s]);continue}a.tn.settings.mosaic[e+"Factor"].w[l[s]];t.url[e][l[s]]=o.coverPhotoBaseUrl+"=h"+a.tn.settings.getH(e,l[s])+"-w"+a.tn.settings.getW(e,l[s])}}return t}var r=NGY2Tools.PreloaderDisplay.bind(a),l=NGY2Tools.NanoAlert,d=(NGY2Tools.GetImageTitleFromURL.bind(a),NGY2Tools.FilterAlbumName.bind(a)),u=NGY2Tools.AlbumPostProcess.bind(a);switch(t){case"AlbumGetContent":var g=arguments[2],m=arguments[3],h=arguments[4],c=arguments[5];o(g,m,h,c)}}}));